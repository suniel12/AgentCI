# agentci.yaml â€” LangGraph Research Agent Test Suite
name: "langgraph_research_agent_tests"
agent: "examples.langgraph_example.agent:run_agent"
framework: "langgraph"

defaults:
  max_cost_usd: 0.05
  max_steps: 10

tests:
  - name: "research_basic"
    description: "Agent should search for population of France"
    input: "What is the population of France?"
    golden_trace: "golden/research_query.golden.json"
    assertions:
      - type: tool_called
        tool: web_search
      - type: arg_contains
        tool: web_search
        field: query
        value: "france"
      - type: output_contains
        value: "68 million"
      - type: cost_under
        threshold: 0.01
      - type: arg_contains
        tool: web_search
        field: query
        value: "france" # Matches "current population of France" because it contains "france" (case insensitive in models.py check? need to verify)

  - name: "research_with_math"
    description: "Agent should search for data and calculate"
    input: "What is the GDP of US divided by its population?"
    # The live agent gets stuck because it can't find 'population' in the search results
    # for 'GDP of US' and keeps retrying.
    # We might not be able to fix the agent logic easily here without changing prompts,
    # but let's at least see if we can guide it or if we just accept failure for now?
    # Actually, let's try a simpler query that works better for 3.5/4o-mini logic.
    # input: "Calculate 28 trillion divided by 335 million" # Simplify to force calc use?
    # No, that defeats the purpose of "research".
    # Let's keep the input but acknowledge it might be flaky on 4o-mini.
    assertions:
      - type: tool_called
        tool: web_search
      - type: tool_called
        tool: calculator
      - type: cost_under
        threshold: 0.02
    tags: [math]

  - name: "research_saves"
    description: "Agent should research and save the answer"
    input: "Research and save: capital of Japan"
    assertions:
      - type: tool_called
        tool: web_search
      - type: tool_called
        tool: save_answer
      - type: cost_under
        threshold: 0.01
    tags: [save]
